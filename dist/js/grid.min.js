function Grid(a){this.score=a?a:0;this.size=a;this.cells=[];this.initGrid()}Grid.prototype.initGrid=function(){var b=this.size;var a=[];for(let y=0;y<b;y++){a[y]=[];for(let x=0;x<b;x++){a[y].push(null)}}this.cells=a};Grid.prototype.randomCell=function(){var b=this.availableCells().avail;var d=b.length;var a=Math.floor(Math.random()*d);var c=Math.floor(Math.random()*2+1)*2;var e=b[a];e.value=c;return e};Grid.prototype.availableCells=function(){if(this.cells.length){var a=[];var b=[];this.cells.forEach(function(c,d){c.forEach(function(e,f){if(!e){a.push({posX:f,posY:d})}else{b.push(e)}})});return{avail:a,unavail:b}}};Grid.prototype.availableCellInline=function(h,d,j){var a=h.posY;var b=h.posX;var g=h.value;var i=null;if(j==="row"){var f=b<d?b+1:b-1;var c=b<d?d+1:d-1;while(f!==c){if(!this.cells[a][f]||this.cells[a][f].value===g){i={posX:f,posY:a,value:!this.cells[a][f]?g:g*2};this.score+=!this.cells[a][f]?0:g*2}else{break}f<c?f++:f--}}else{if(j==="col"){var e=a<d?a+1:a-1;var c=a<d?d+1:d-1;while(e!==c){if(!this.cells[e][b]||this.cells[e][b].value===g){i={posX:b,posY:e,value:!this.cells[e][b]?g:g*2};this.score+=!this.cells[e][b]?0:g*2}else{break}e<c?e++:e--}}}return i};Grid.prototype.updataCell=function(b,a,c){var e=a.posX;var d=a.posY;if(b==="remove"){this.cells[d][e]=null}else{if(b==="fill"){this.cells[d][e]={posX:e,posY:d,value:c}}}};Grid.prototype.moveCells=function(c,b){var d=[];var g=c===2||c===3?3:0;var a=c===2||c===3?-1:4;if(c===0||c===2){var f=!c?0:3;while(g!==a){for(let y=0;y<this.size;y++){if(this.cells[y][g]!==null){var e=this.availableCellInline({posX:g,posY:y,value:this.cells[y][g].value},f,"row");if(e!==null){d.push({redrawCell:e,delCell:this.cells[y][g]});if(!b){this.updataCell("remove",{posX:g,posY:y});this.updataCell("fill",{posX:e.posX,posY:e.posY},e.value)}}}}g<a?g++:g--}}else{if(c===1||c===3){var f=c===1?0:3;while(g!==a){for(let x=0;x<this.size;x++){if(this.cells[g][x]!==null){var e=this.availableCellInline({posX:x,posY:g,value:this.cells[g][x].value},f,"col");if(e!==null){d.push({redrawCell:e,delCell:this.cells[g][x]});if(!b){this.updataCell("remove",{posX:x,posY:g});this.updataCell("fill",{posX:e.posX,posY:e.posY},e.value)}}}}g<a?g++:g--}}}return d};
